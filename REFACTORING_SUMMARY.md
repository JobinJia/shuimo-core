# Shanshui.html TypeScript é‡æ„æ€»ç»“

## ğŸ“Š é‡æ„æˆæœ

### å·²å®Œæˆæ¨¡å—ï¼ˆç¬¬ä¸€æ‰¹ï¼‰

æœ¬æ¬¡é‡æ„æˆåŠŸå°† `shanshui.html` ä¸­çº¦ **20-25%** çš„æ ¸å¿ƒä»£ç è½¬æ¢ä¸º TypeScriptï¼Œæ¶µç›–äº†åŸºç¡€è®¾æ–½å±‚å’Œç»˜å›¾åŸè¯­å±‚ã€‚

| ç±»åˆ« | æ¨¡å— | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° | çŠ¶æ€ |
|------|------|--------|----------|------|
| åŸºç¡€è®¾æ–½ | PRNG | 2 | ~100 | âœ… å®Œæˆ |
| åŸºç¡€è®¾æ–½ | PerlinNoise | 2 | ~170 | âœ… å®Œæˆ |
| åŸºç¡€è®¾æ–½ | PolyTools | 2 | ~230 | âœ… å®Œæˆ |
| å·¥å…·å‡½æ•° | Math/Random/Bezier/SVG | 5 | ~180 | âœ… å®Œæˆ |
| ç»˜å›¾åŸè¯­ | Stroke/Blob/div | 4 | ~200 | âœ… å®Œæˆ |
| å…ƒç´  | Water | 2 | ~65 | âœ… å®Œæˆ |
| å…¥å£æ–‡ä»¶ | å„å±‚çº§ index | 3 | ~90 | âœ… å®Œæˆ |
| **åˆè®¡** | **8 å¤§æ¨¡å—** | **20** | **~1,035** | **âœ… å®Œæˆ** |

### å¾…å®Œæˆæ¨¡å—ï¼ˆåç»­æ‰¹æ¬¡ï¼‰

| æ¨¡å— | å¤æ‚åº¦ | é¢„è®¡è¡Œæ•° | é¢„è®¡å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|------|--------|----------|------------|--------|
| Man (äººç‰©) | â­â­â­â­ | ~300 | 4-5h | é«˜ |
| Tree (æ ‘) | â­â­â­â­â­ | ~600 | 4-6h | ä¸­ |
| Arch (å»ºç­‘) | â­â­â­â­â­ | ~950 | 6-8h | ä¸­ |
| Mount (å±±) | â­â­â­â­â­ | ~725 | 6-8h | ä½ |
| è¾…åŠ©å‡½æ•° | â­â­â­ | ~350 | 3-4h | ä½ |

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç›®å½•ç»“æ„

```
packages/core/src/
â”œâ”€â”€ foundation/           # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ random/          # éšæœºæ•°ç”Ÿæˆ (PRNG)
â”‚   â”œâ”€â”€ noise/           # å™ªå£°ç”Ÿæˆ (Perlin)
â”‚   â””â”€â”€ geometry/        # å‡ ä½•è¿ç®— (PolyTools)
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°å±‚
â”‚   â”œâ”€â”€ math.ts          # æ•°å­¦å·¥å…·
â”‚   â”œâ”€â”€ random.ts        # éšæœºå·¥å…·
â”‚   â”œâ”€â”€ bezier.ts        # è´å¡å°”æ›²çº¿
â”‚   â””â”€â”€ svg.ts           # SVG ç”Ÿæˆ
â”œâ”€â”€ drawing/             # ç»˜å›¾åŸè¯­å±‚
â”‚   â”œâ”€â”€ Stroke.ts        # ç¬”è§¦
â”‚   â”œâ”€â”€ Blob.ts          # å¢¨ç‚¹
â”‚   â””â”€â”€ div.ts           # ç»†åˆ†
â””â”€â”€ elements/            # å…ƒç´ å±‚
    â””â”€â”€ natural/         # è‡ªç„¶å…ƒç´ 
        â””â”€â”€ Water.ts     # æ°´é¢
```

### è®¾è®¡åŸåˆ™

1. **åˆ†å±‚æ¶æ„**
   - Foundation: æœ€åº•å±‚ï¼Œæä¾›åŸºç¡€ç®—æ³•
   - Utils: å·¥å…·å‡½æ•°ï¼Œæ— çŠ¶æ€
   - Drawing: ç»˜å›¾åŸè¯­ï¼Œç”Ÿæˆ SVG ç‰‡æ®µ
   - Elements: é«˜çº§å…ƒç´ ï¼Œç»„åˆåŸè¯­

2. **ç±»å‹å®‰å…¨**
   - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
   - å¯¼å‡ºå…³é”®ç±»å‹ä¾›å¤–éƒ¨ä½¿ç”¨
   - ä¸¥æ ¼çš„å‚æ•°ç±»å‹æ£€æŸ¥

3. **API è®¾è®¡**
   - æä¾› Class é™æ€æ–¹æ³•ï¼ˆå¦‚ `Stroke.generate()`ï¼‰
   - åŒæ—¶æä¾›ä¾¿æ·å‡½æ•°ï¼ˆå¦‚ `stroke()`ï¼‰
   - ç»Ÿä¸€çš„ options å‚æ•°æ¨¡å¼

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. ç±»å‹å®šä¹‰

```typescript
// å‡ ä½•ç±»å‹
export type Point = [number, number];
export type Line = [Point, Point];
export type Polygon = Point[];

// é€‰é¡¹æ¥å£
export interface StrokeOptions {
  xof?: number;
  yof?: number;
  wid?: number;
  col?: string;
  noi?: number;
  out?: number;
  fun?: (x: number) => number;
}
```

### 2. å‡½æ•°å¼ç¼–ç¨‹

```typescript
// ä½¿ç”¨ map/reduce ç­‰å‡½æ•°å¼æ–¹æ³•
const vtxlist = ptlist.map((x) => [x[0] + xof, x[1] + yof]);
const midpoint = plist.reduce(
  (acc, v) => [v[0] / plist.length + acc[0], v[1] / plist.length + acc[1]],
  [0, 0] as Point
);
```

### 3. æ¨¡å—åŒ–å¯¼å‡º

```typescript
// å„å±‚çº§éƒ½æœ‰ç»Ÿä¸€çš„ index.ts
export * from './random';
export * from './noise';
export * from './geometry';
```

## ğŸ“ˆ è´¨é‡ä¿è¯

### ä»£ç è§„èŒƒ
- âœ… ä½¿ç”¨ ES6+ è¯­æ³•
- âœ… ä¸¥æ ¼çš„ TypeScript ç±»å‹
- âœ… ç»Ÿä¸€çš„ä»£ç é£æ ¼
- âœ… æ¸…æ™°çš„å‘½åè§„èŒƒ

### æ–‡æ¡£å®Œæ•´æ€§
- âœ… JSDoc æ³¨é‡Š
- âœ… å‚æ•°è¯´æ˜
- âœ… è¿”å›å€¼ç±»å‹
- âœ… ä½¿ç”¨ç¤ºä¾‹

### é€»è¾‘ä¸€è‡´æ€§
- âœ… å®Œå…¨ä¿ç•™åŸå§‹ç®—æ³•
- âœ… ä¿æŒè®¡ç®—ç²¾åº¦
- âœ… è¾¹ç•Œæ¡ä»¶å¤„ç†
- âœ… é»˜è®¤å€¼è®¾ç½®

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2 å‘¨ï¼‰
1. âœ… åŸºç¡€è®¾æ–½å±‚é‡æ„ (å·²å®Œæˆ)
2. â³ ç¼–å†™å•å…ƒæµ‹è¯•
3. â³ åˆ›å»ºäº¤äº’å¼ç¤ºä¾‹
4. â³ é‡æ„ Man class

### ä¸­æœŸç›®æ ‡ï¼ˆ1 ä¸ªæœˆï¼‰
1. é‡æ„ Tree class
2. é‡æ„ Arch class
3. å®Œå–„æ–‡æ¡£å’Œç¤ºä¾‹
4. æ€§èƒ½ä¼˜åŒ–

### é•¿æœŸç›®æ ‡ï¼ˆ2-3 ä¸ªæœˆï¼‰
1. é‡æ„ Mount class
2. å®Œæˆæ‰€æœ‰è¾…åŠ©å‡½æ•°
3. å®Œæ•´çš„æµ‹è¯•è¦†ç›–
4. å‘å¸ƒ v1.0

## ğŸ“ ä½¿ç”¨è¯´æ˜

### å®‰è£…
```bash
cd packages/core
pnpm install
```

### å¯¼å…¥
```typescript
// å¯¼å…¥æ‰€æœ‰
import * as Shuimo from '@shuimo/core';

// æŒ‰éœ€å¯¼å…¥
import { Stroke, Water, PRNG } from '@shuimo/core';
```

### åŸºæœ¬ä½¿ç”¨
```typescript
import { stroke, Water, overrideMathRandom } from '@shuimo/core';

// åˆå§‹åŒ–
overrideMathRandom();

// ç»˜åˆ¶ç¬”è§¦
const svg = stroke([[0,0], [100,100]], { wid: 3 });

// ç»˜åˆ¶æ°´é¢
const water = Water.generate(0, 200, 12345, { len: 800 });
```

è¯¦ç»†ç¤ºä¾‹è¯·å‚è€ƒ `USAGE_EXAMPLES.md`ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `REFACTORING_PROGRESS.md` - è¯¦ç»†çš„é‡æ„è¿›åº¦æŠ¥å‘Š
- `USAGE_EXAMPLES.md` - ä½¿ç”¨ç¤ºä¾‹å’Œ API æ–‡æ¡£
- `reference-code/shanshui.html` - åŸå§‹ä»£ç å‚è€ƒ

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®åŸºäº Lingdong Huang çš„ [shan-shui-inf](https://github.com/LingDong-/shan-shui-inf) é¡¹ç›®è¿›è¡Œé‡æ„ã€‚

---

**æœ€åæ›´æ–°**: 2025-11-26
**é‡æ„è¿›åº¦**: 20-25% (ç¬¬ä¸€æ‰¹åŸºç¡€æ¨¡å—)
